<!DOCTYPE html>
<html lang="en">
<meta http-equiv="refresh" content="1000">

<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="style.css">
  <script src="scripts.js" defer></script>
  <title>Weather Dashboard</title>
</head>
<!--HTML Body containing all elements-->

<body class="dashboardBody">
  <div class="jumbotron bg-dark text-white">
    <h1 class="text-center" id="title">Weather Dashboard</h1>
  </div>

  <div class="container main-container">
    <div class="row main-row">


      <div class="col-3 col-left">
        <form class="form-inline" id="search-area">
          <h4 class="text-center">Search for a City:</h4>
          <input class="form-control mr-sm-2" type="search" placeholder="Search for a city" aria-label="Search"
            id="left-search">
          <button class="btn btn-outline-success my-2 my-sm-0 btn-lg" type="submit" id="left-search-button"><i
              class="fa fa-search" aria-hidden="true"></i></button>
        </form>
        <div class="card" id="search-history">
          <ul class="list-group list-group-flush">
            <li class="list-group-item" id="city-1">City1</li>
            <li class="list-group-item" id="city-2">City2</li>
            <li class="list-group-item" id="city-3">City3</li>
            <li class="list-group-item" id="city-4">City4</li>
            <li class="list-group-item" id="city-5">City5</li>
            <li class="list-group-item" id="city-6">City6</li>
            <li class="list-group-item" id="city-7">City7</li>
            <li class="list-group-item" id="city-8">City8</li>
          </ul>
        </div>
      </div>

      <div class="col-9 col-right">
        <div class="card" id="top-card">
          <div class="card-body" id="top-card-body">
            <h5 class="card-title" id="top-card-title"><span id="city-name"></span><span id="city-date"></span><span
                id="city-icon"></span>Special title treatment</h5>
            <h5 class="card-title card-text" id="card-subtext">Temperature : <span class="top-card-temperature"
                id="card-temp-0"></span><span>&#176;</span>F</h5>
            <h5 class="card-title card-text" id="card-subtext">Humidity : <span class="top-card-humidity"
                id="card-humidity-0"></span></h5>
            <h5 class="card-title card-text" id="card-subtext">Wind Speed : <span class="top-card-windspeed"
                id="card-windspeed-0"></span></h5>
            <h5 class="card-title card-text" id="card-subtext">UV Index : <span class="top-card-uv"
                id="card-uv-0"></span></h5>
          </div>
        </div>

        <h2 class="forecast">5-Day Forecast:</h2>

        <div class="container">

          <div class="card-deck">
            <div class="card bg-primary" id="card-contents">
              <div class="card-header card-text-head" id="card-forecast-date-1">Header</div>
              <div class="card-body text-center">
                <i class="fa fa-cloud"><span id="forcast-icon-1"></span></i>
                <h5 class="card-title temp" id="bottom-card-text">Temp : <span
                    id="card-temp-1"></span><span>&#176;</span>F</h5>
                <h5 class="card-title" id="bottom-card-text">Humidity : <span id="card-humidity-1"></span></h5>
              </div>
            </div>

            <div class="card bg-primary" id="card-contents">
              <div class="card-header card-text-head" id="card-forecast-date-1">Header</div>
              <div class="card-body text-center">
                <i class="fa fa-cloud"><span id="forcast-icon-1"></span></i>
                <h5 class="card-title temp" id="bottom-card-text">Temp : <span
                    id="card-temp-2"></span><span>&#176;</span>F</h5>
                <h5 class="card-title" id="bottom-card-text">Humidity : <span id="card-humidity-2"></span></h5>
              </div>
            </div>

            <div class="card bg-primary" id="card-contents">
              <div class="card-header card-text-head" id="card-forecast-date-1">Header</div>
              <div class="card-body text-center">
                <i class="fa fa-cloud"><span id="forcast-icon-1"></span></i>
                <h5 class="card-title temp" id="bottom-card-text">Temp : <span
                    id="card-temp-3"></span><span>&#176;</span>F</h5>
                <h5 class="card-title" id="bottom-card-text">Humidity : <span id="card-humidity-3"></span></h5>
              </div>
            </div>

            <div class="card bg-primary" id="card-contents">
              <div class="card-header card-text-head" id="card-forecast-date-1">Header</div>
              <div class="card-body text-center">
                <i class="fa fa-cloud"><span id="forcast-icon-1"></span></i>
                <h5 class="card-title temp" id="bottom-card-text">Temp : <span
                    id="card-temp-4"></span><span>&#176;</span>F</h5>
                <h5 class="card-title" id="bottom-card-text">Humidity : <span id="card-humidity-4"></span></h5>
              </div>
            </div>

            <div class="card bg-primary" id="card-contents">
              <div class="card-header card-text-head" id="card-forecast-date-1">Header</div>
              <div class="card-body text-center">
                <i class="fa fa-cloud"><span id="forcast-icon-1"></span></i>
                <h5 class="card-title temp" id="bottom-card-text">Temp : <span
                    id="card-temp-5"></span><span>&#176;</span>F</h5>
                <h5 class="card-title" id="bottom-card-text">Humidity : <span id="card-humidity-5"></span></h5>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script type="text/javascript">
    // This is our API key
    var APIKey = "7ae0000de388b9c572a093a2d744bb68";
    //Click function that triggers API call to open weather
    $('#left-search-button').click(function (e) {
      //Stops defauls page refresh
      e.preventDefault()
      //Reads the present city
      citySearch = ($('#left-search').val())
      //Makes first API call
      $.ajax({
        'url': "https://api.openweathermap.org/data/2.5/forecast?q=" + citySearch + '&&appid=' + APIKey + '&cnt=6'
      }).then(function (response) {
        //Mine to city Name
        console.log(response)
        cityName = response.city.name
        cityLatt = (response.city.coord.lat).toFixed(2)
        cityLong = (response.city.coord.lon).toFixed(2)

        for (var i=0; i<6; i++){
        console.log((cityTemperature = response.list[i].main.temp))
        cityTemperature = ((response.list[i].main.temp - 273.15) * 1.80 + 32).toFixed(2)
        cityHumidity = (response.list[i].main.humidity)
        cityWindSpeed = (response.list[i].wind.speed)
        cityWindDirection = (response.list[i].wind.deg)
        postTemperature = $('#card-temp-' + i).text(cityTemperature)
        postHumidity = $('#card-humidity-' + i).text(cityHumidity + ' %')
        postWindSpeed = $('#card-windspeed-' + i).text(cityWindSpeed + ' MPH')}
        
        //console.log(cityName)
        //console.log(cityLong)
        //console.log(cityLatt)
        
        //console.log('Temperature in ' + cityName + ' is ' + cityTemperature)
        //console.log('Humidity in ' + cityName + ' is ' + cityHumidity + '%')
        //console.log('Wind Speed in ' + cityName + ' is ' + cityWindSpeed + ' MPH at ' + cityWindDirection)
        //console.log(cityName + ' is on Longittude ' + cityLong + ' Lattitude ' + cityLatt)      
        $.ajax({
          'url': 'http://api.openweathermap.org/data/2.5/uvi/forecast?lat=' + cityLatt + '&lon=' + cityLong + '&appid=' + APIKey
        }).then(function (response) {
          if (cityLong && cityLatt)  {  
            for (var i=0; i<6; i++)   {  
            cityUVIndex = response[i].value
            console.log(cityUVIndex)
            console.log('UV Index of ' + cityName + ' is ' + cityUVIndex)          
          $('#card-uv-' + i).text(cityUVIndex)
          console.log('card-uv-' + i)
        }}})
      })
    })

  </script>


</body>

</html>